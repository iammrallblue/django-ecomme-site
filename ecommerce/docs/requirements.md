# 電商網購網站需求文檔

- SRS（Software Requirements Specification）結構

## 🧱 SOLID 五大設計原則

這五個原則是由 Robert C. Martin（Uncle Bob）提出的，幫助我們設計**高內聚、低耦合、易維護的系統架構**。以下是簡明筆記，幫你記清楚：

| 縮寫 | 原則名稱                              | 解釋與實務含義 |
|------|---------------------------------------|----------------|
| **S** | **Single Responsibility Principle（SRP）** | 一個類別或模組只負責一件事。<br>📌 例：User 模型不要同時管帳號、訂單與購物車 |
| **O** | **Open/Closed Principle（OCP）**       | 對擴展開放、對修改封閉。<br>📌 例：透過繼承或注入來擴展行為，而不是直接修改現有類別 |
| **L** | **Liskov Substitution Principle（LSP）** | 子類別應能替代父類別使用。<br>📌 例：若 `Staff` 是 `User` 的子類別，那它在任何 `User` 可用處也能正常運作 |
| **I** | **Interface Segregation Principle（ISP）** | 不應強迫物件實作它不需要的介面。<br>📌 例：後台用戶不必實作前台顯示用的欄位功能 |
| **D** | **Dependency Inversion Principle（DIP）** | 高階模組不應依賴細節，兩者應依賴抽象。<br>📌 例：用抽象類別控制服務依賴，實作細節可切換（像付款邏輯、寄信後端等） |

**🧠 要不要背起來？** 其實不用硬背，但你可以這樣記：

> ✔️ SRP → 不要亂裝東西在同一個地方
> ✔️ OCP → 想加功能就擴展，別硬改舊的
> ✔️ LSP → 父類別能做的，子類別也要能接得住
> ✔️ ISP → 功能拆拆拆，用多少給多少
> ✔️ DIP → 高層定規則，底層照著走

---
---
---

## 功能需求

### 1. 用戶管理系統 (User Management)

#### 1.1 用戶註冊

- **功能描述**: 新用戶可以註冊帳號
- **輸入**: 用戶名、郵箱、密碼、確認密碼
- **驗證規則**:
  - 用戶名唯一性
  - 郵箱格式驗證和唯一性
  - 密碼強度驗證 (最少8位，包含字母和數字)
- **輸出**: 註冊成功訊息或錯誤訊息

#### 1.2 用戶登入

- **功能描述**: 已註冊用戶可以登入系統
- **輸入**: 用戶名/郵箱、密碼
- **輸出**: 認證 Token 或錯誤訊息

#### 1.3 用戶個人資料管理

- **功能描述**: 用戶可以查看和更新個人資料
- **包含字段**: 姓名、郵箱、電話、地址等
- **權限**: 僅限用戶本人操作

### 2. 商品管理系統 (Product Management)

#### 2.1 商品展示

- **功能描述**: 顯示商品列表和詳情
- **包含信息**: 商品名稱、描述、價格、圖片、庫存、分類
- **功能**: 分頁、搜索、分類篩選、價格排序

#### 2.2 商品管理 (管理員功能)

- **功能描述**: 管理員可以管理商品
- **操作**: 新增、編輯、刪除、上架/下架商品
- **權限**: 僅限管理員

#### 2.3 分類管理

- **功能描述**: 商品分類的層級管理
- **功能**: 分類 CRUD 操作、層級結構

### 3. 購物車系統 (Shopping Cart)

#### 3.1 購物車操作

- **功能描述**: 用戶可以管理購物車中的商品
- **操作**: 添加商品、修改數量、刪除商品、清空購物車
- **限制**: 庫存數量檢查

#### 3.2 購物車查看

- **功能描述**: 顯示購物車內容和總金額
- **信息**: 商品詳情、數量、小計、總計

### 4. 訂單管理系統 (Order Management)

#### 4.1 訂單創建

- **功能描述**: 將購物車內容轉換為訂單
- **流程**: 確認商品、填寫收貨信息、選擇支付方式
- **驗證**: 庫存檢查、價格驗證

#### 4.2 訂單查詢

- **功能描述**: 用戶可以查詢自己的訂單
- **信息**: 訂單狀態、商品詳情、支付狀態、物流信息

#### 4.3 訂單管理 (管理員功能)

- **功能描述**: 管理員可以管理所有訂單
- **操作**: 訂單狀態更新、訂單詳情查看

### 5. 支付系統 (Payment System)

#### 5.1 支付接口

- **功能描述**: 整合第三方支付服務
- **支持方式**: 信用卡、PayPal、微信支付等 (後期擴展)
- **功能**: 支付請求、支付確認、退款處理

---
---

## 非功能需求

### 1. 性能需求

- API 響應時間 < 2秒
- 支持至少 100 並發用戶
- 數據庫查詢優化

### 2. 安全需求

- 密碼加密存儲
- API 認證和授權
- 輸入數據驗證和清理
- SQL 注入防護

### 3. 可用性需求

- 7x24 小時服務可用性
- 數據備份和恢復
- 錯誤處理和日誌記錄

### 4. 可維護性需求

- 代碼規範和注釋
- 單元測試覆蓋率 > 80%
- API 文檔完整性
- 版本控制

---
---

## API 設計原則

### 1. RESTful 設計

- 使用標準 HTTP 方法 (GET, POST, PUT, DELETE)
- 資源導向的 URL 設計
- 統一的響應格式

### 2. 版本控制

- API 版本號前綴: `/api/v1/`
- 向後兼容性考慮

### 3. 錯誤處理

- 標準 HTTP 狀態碼
- 詳細的錯誤訊息格式
- 國際化支持

---
---

## 數據需求

### 1. 用戶數據

- 基本信息、認證信息、權限信息

### 2. 商品數據

- 商品基本信息、價格信息、庫存信息、分類信息

### 3. 訂單數據

- 訂單基本信息、商品明細、支付信息、物流信息

### 4. 系統數據

- 日誌數據、配置數據、統計數據

---
---
---

## 用戶角色需求分析

> 「用戶角色需求分析（User Role Requirement Analysis）」的核心構成
**它們共同回答了這三個問題：** 這個角色是誰？（`User Role`）, 他要完成什麼任務？（`User Story` & `Use Case`）, 為了完成任務，他需要什麼資料與權限？（`Entity` & `Field Analysis`）

- 1 **專注在「使用者建模（`User Modeling`）」／「角色設計（`User Roles Design`）」** 因為`models.py` 中的欄位的設計應該源自對使用場景和角色的理解.

- 2 不是「定義欄位/字段 → 上 `models.py`」這樣單向思考，而是：「場景驅動」↔ 「欄位需求」↔ 「資料模型」三者反覆推進

- 3 先設計一個用戶角色的`User Stories` 比如 `Customer`， 接著做 `Use Case` → `Business Rule` → `Entity Analysis` → `Fields`
  - 「`User Story` → `Use Case` → `Business Rule` → `Entity Analysis` → `Fields`」

### 建模前的步驟

| 步驟編號 | 名稱                     | 說明                                                                 |
|----------|--------------------------|----------------------------------------------------------------------|
| 1       | 定義主要用戶角色（主類型） | 你已經完成（`customer`, `staff`, 等），這是建模的基礎。                       |
| 2       | 撰寫角色任務與使用者故事    | 讓你了解每個角色在系統裡「要做什麼」，避免只從資料角度建模。                     |
| 3       | 梳理主要流程與功能模塊      | 包含購物、訂單、配送、庫存、客服等，有助於明確資料間的關聯。                    |
| 4       | 對每個角色抽出必要欄位      | 欄位不必一次到位，但至少確保每個角色的核心動作可支援        |
| 5       | 定義資料模型架構（models） | 這時候才進入 `models.py`，此時資料模型有業務背景支撐，不會空泛亂加欄位。          |
| 6       | 繪製 ER 圖（可選）          | 若資料模型多或關聯複雜（像訂單、商品、庫存），可用圖輔助思考與溝通。              |

### 主次分類用戶角色體系

**設計原則**：採用 `主分類(user_type)` + `子分類(sub_role)` 的分層設計

**主分類定義**：

```python
MAIN_USER_TYPES = [
    ('customer', 'Customer'),                    # 顧客（普通+VIP+會員+批發）
    ('vendor', 'Vendor'),                        # 商家（如自營、合作供應商）
    ('store_associate', 'Store Associate'),      # 實體門市的店員
    ('delivery_driver', 'Delivery Driver'),      # 自營物流或合作配送人員
    ('supplier', 'Supplier'),                    # 原始供應商（貨源端）
    ('support', 'Customer Support'),             # 客服人員
    ('admin', 'Administrator'),                  # 系統超管
    ('staff', 'Staff'),                          # 內部管理或支援人員（含採購、營運）
]
```

### 子角色分類設計

#### Customer 子角色（重點）

```python
CUSTOMER_SUB_ROLES = [
    (None, '普通客戶'),                    # 默認客戶
    ('member_bronze', '銅卡會員'),         # 會員積分系統
    ('member_silver', '銀卡會員'),
    ('member_gold', '金卡會員'),
    ('wholesale_small', '小批發客戶'),      # 批發折扣系統
    ('wholesale_large', '大批發客戶'),
]
```

#### Store Associate 子角色

```python
STORE_ASSOCIATE_SUB_ROLES = [
    ('cashier', '收銀員'),                 # 主要處理實體店
    ('online_order', '線上訂單專員'),       # 專門處理網上訂單
    ('customer_service', '客服專員'),       # 客戶服務
    ('inventory', '庫存管理員'),           # 庫存相關
]
```

#### Delivery Driver 子角色

```python
DELIVERY_SUB_ROLES = [
    ('part_time', '兼職配送'),             # 員工兼職送貨
    ('full_time', '專職配送'),             # 專門配送人員
    ('owner', '老闆親送'),                 # 老闆本人配送
]
```

---
---

## User Stories

**🧠 專業流程建議是這樣**

| 階段 | 做法                        | 產出                          |
|------|-----------------------------|-------------------------------|
| 角色定義 | 主角色 + 子角色設計             | 角色清單與描述                  |
| 使用者故事 | 每個角色撰寫 3–5 條故事         | 使用場景與主要任務              |
| 資料推導 | 從故事中推導出與「使用者本人相關」的資料 | 模型欄位草圖 (`User` 的欄位等)     |
| 架構補強 | 從技術／業務角度補上遺漏欄位      | 例如 `created_at`, `is_verified` 等 |
| 整理輸出 | 匯總成最小可用模型（MVP）        | `models.py` 內的 User 定義       |

**User Stories的理解是：**

- 先定義 **「使用者建模（`User Modeling`）」／「角色設計（`User Roles Design`）」** 也就是「主用戶角色 + 子角色」

- 接著針對每個角色撰寫一組使用者故事（User Stories）然後從故事中 _**反推行為、流程與欄位需求**_ → 設計資料模型
  - `User Story`的數量按照「主用戶角色」來判定，比如「Customer」是核心主用戶角色那麼它的 `User Story` 相比其他的會對很多

- `User Story` 說的是：「我想要做什麼，為了達成什麼目的」, 它講的是需求動機，不是操作細節

**🚧 需注意的要點**

1. **User Stories 能夠覆蓋欄位設計的 80–90%，但不等於直接產生欄位**
   - 因為：使用者故事會聚焦在「行為」，而不是所有資料需求（例如後台管理用欄位、稽核用欄位）
   - 所以：你還需要補上非功能性欄位，如 `is_active`, `created_at`, `updated_at`, 等

2. **User Stories 重點在於「做什麼」，不是「有哪些資料」**
   - 所以你需要從 User Story 推導出使用者與資料之間的互動，比如：
     > 作為顧客，我希望能將商品加入購物車 ➜ 你會發現這背後其實需要一個關聯 `User` ↔ `CartItem`， ➜ 而不是 `User` 本身新增欄位。

3. **有些欄位來自企業策略或 UX 需求，而非 `User Story` 本身**
   - 例如：你想記錄「顧客最常使用的實體門市」，可能是因為日後行銷或運費計算要用到，而不是因為某個顧客在 `User Story` 中說了什麼。

**Use Case的理解：**

- `Use Case` 是：「使用者做了什麼 → 系統該怎麼反應」。它是操作流程，像一條完整劇情線。

- `Use Case` 說的是：「我怎麼一步步操作來完成這個需求」, 它講的是互動流程，誰做了什麼，系統回應什麼

**Business Rule的理解：**

- `Business Rule` 是：「當某些情況發生時，系統必須遵守的條件或限制」。它是規則，是不能被違反的邏輯底線。

- `Business Rules` 中文可以叫「業務規則」，它不是缺點，它是系統或流程中需要遵守的規則、條件、限制、例外。它就像是法律條文一樣，定義了什麼可以、什麼不可以、什麼情況下要特別處理。

- `Business Rules` 說的是：「在執行這個流程時，有哪些業務邏輯或限制條件必須遵守」, 它是針對 某個 `Use Case` 的執行場景 去定義的

---

### Customer User Stories

_**一，作為訪客，我希望能不註冊就瀏覽商品分類與商品頁，這樣我可以了解網站提供什麼。**_

_**二，作為註冊用戶，我希望能建立帳號並登入，這樣我可以保存購物記錄與個人資料。**_

_**三，作為顧客，我希望能把商品加入購物車或收藏清單，這樣我可以之後再下單。**_

_**四，作為顧客，我希望能編輯我的個人資訊，例如收貨地址與聯絡方式，這樣我下單時可以快速填寫。**_

_**五，作為顧客，我希望可以選擇付款方式與配送方式，完成結帳流程，這樣我就能完成訂單。**_

_**六，作為顧客，我希望能查閱我的訂單記錄與每一筆的配送狀態，這樣我可以確認包裹是否已出貨。**_

_**七，作為顧客，我希望能收到 Email 或簡訊通知，提醒我訂單成功、已出貨或取消，這樣我不需要自己反覆查詢。**_

_**八，作為顧客，我希望可以留言或給商品評價，這樣其他買家也能參考我的經驗。**_

_**九，作為顧客，我希望可以查閱我的積分、優惠券或會員等級，這樣我能清楚知道有什麼優惠。**_

_**十，作為顧客，我希望能夠停用帳號或申請刪除帳號資料，這樣我可以主動控制我的個資與帳號狀態。**_

_**十一，作為顧客，我希望能查看附近的實體門市資訊，並選擇是否要到店自取，這樣我可以節省運費或立即取得商品。**_

_**十二，作為顧客，我希望能在促銷期間使用折扣碼或優惠券，並在結帳時計算優惠，這樣我可以感覺物超所值。**_

_**十三，作為顧客，我希望可以收到針對我的購買行為的推薦商品，這樣我可以快速發現我可能需要的新商品。**_

_**十四，作為顧客，我希望可以設定商品補貨提醒或追蹤缺貨商品，這樣一旦商品補貨我能第一時間知道。**_

_**十五，作為顧客，我希望能夠在訂單還沒出貨前，進行取消或修改訂單，這樣我能避免下錯單或資訊有誤。**_

- 後續可能會增加 `User Story`
- **NOTE: 每條 `User Story` 可拆解為多條 `Use Case`**

---
---

## Requirements - Customer Module

### User Role: Customer

---

### Customer - User Story 1

作為訪客，我希望能不註冊就瀏覽商品分類與商品頁，這樣我可以了解網站提供什麼。

#### Use Case 1.1 – Browse Product Categories

- **名稱**：訪客瀏覽商品資訊
- **起始者**：未登入使用者
- **前置條件**：使用者成功載入首頁
- **流程**：

1. 訪客打開網站首頁
2. 點選商品分類（例如：零食、飲料）
3. 系統顯示該分類下的商品列表
4. 訪客點進任一商品
5. 系統顯示商品詳細資訊（名稱、價格、庫存狀態、圖片、說明）
6. 訪客可自由切換商品或返回分類列表

- **結果**：訪客可以自由查看網站商品資訊，無需帳號或登入

#### Business Rules for Use Case 1.1

- **BR1.1** _(Access Control)_：未登入使用者僅可看到標記為「公開」的商品分類
- **BR1.2** _(Access Control)_：系統不得顯示會員專屬商品或價格
- **BR1.3** _(UI Constraint)_：訪客介面不可出現「加入購物車」、「加入收藏」等互動按鈕
- **BR1.4** _(Fallback Flow)_：若分類為「下架」或「隱藏」，則不出現在分類清單中

#### Use Case 1.2 – View Product Detail

- **名稱**： 訪客點擊商品後進入商品詳情頁
- **起始者**：未登入使用者
- **前置條件**：使用者正在瀏覽分類商品頁
- **流程**：

1. 使用者點選一筆商品
2. 系統顯示該商品詳情（圖片、價格、描述、庫存）
3. 使用者可選擇前往註冊或繼續瀏覽其他商品

- **結果**：訪客可以閱讀詳細資訊，但無法互動（加入購物車等）

#### Business Rules for Use Case 1.2

- **BR1.5** _(Access Control)_：訪客不可查看會員價或折扣後價格
- **BR1.6** _(UI Constraint)_：頁面顯示完整資訊但互動元素 disabled（不可點擊）
- **BR1.7** _(Behavior Logic)_：訪客若點擊互動功能（例如加入購物車），系統跳轉至登入頁
- **BR1.8** _(Fallback Flow)_：若商品已下架，導向「商品不存在」頁面

---
---

### Customer - User Story 2

作為註冊用戶，我希望能建立帳號並登入，這樣我可以保存購物記錄與個人資料。

#### Use Case 2.1 - 帳號註冊與登入

- **起始者**：訪客
- **前置條件**：尚未註冊且未登入
- **流程**：

1. 訪客點擊「註冊」
2. 輸入 email、密碼、姓名等必要欄位
3. 系統驗證欄位格式，建立帳號
4. 註冊成功後自動登入或導向登入頁
5. 登入頁輸入帳號密碼
6. 系統驗證正確性，登入成功後導向會員中心或首頁

- **結果**：使用者成功建立帳號並登入系統，可存取個人專屬功能

#### Business Rules for Use Case 2.1

- **BR2.1** _(Validation)_：Email 必須符合格式，且不得重複
- **BR2.2** _(Validation)_：密碼需符合長度與複雜度規則（至少8字元，含字母與數字）
- **BR2.3** _(Anti-Spam)_：每個 IP 在特定時間內不得註冊過多帳號（防止濫用）
- **BR2.4** _(Activation)_：系統須寄送歡迎郵件或驗證信作為註冊成功通知
- **BR2.5** _(Fallback Flow)_：若 Email 已存在，顯示錯誤訊息並引導至登入頁
- **BR2.6** _(Data Integrity)_：建立帳號時須自動初始化會員資料（如積分=0、會員等級=一般）

#### Use Case 2.2 – 帳號登入

**名稱**：登入既有帳號
**起始者**：已註冊使用者
**前置條件**：使用者已完成註冊
**流程**：

1. 使用者點選「登入」
2. 系統顯示登入表單（Email、密碼）
3. 使用者輸入資料並送出
4. 系統驗證帳號與密碼正確性
5. 驗證成功則登入，導向會員中心

**結果**：使用者成功登入系統，可使用個人化功能

#### Business Rules for Use Case 2.2

- **BR2.7** _(Authentication)_：密碼比對使用加密方式（例如 bcrypt）
-	**BR2.8** _(Session Control)_：登入後建立 Session 有效時間（如 24 小時）
-	**BR2.9** _(Error Feedback)_：若密碼錯誤或帳號不存在，顯示不具暴露風險的錯誤訊息
-	**BR2.10** _(Lockout Rule)_：若連續登入失敗超過 5 次，暫時鎖定帳號或要求驗證碼
-	**BR2.11** _(Auto-Redirect)_：登入後自動導回使用者原先瀏覽頁面（若有）

#### Use Case 2.3 – 忘記密碼並重設

- **名稱**：使用者重設密碼
- **起始者**：已註冊但無法登入的使用者
- **前置條件**：使用者無法正確登入帳號
- **流程**：

1. 使用者點選登入頁的「忘記密碼」連結
2. 系統顯示 Email 輸入欄位
3. 使用者輸入已註冊 Email 並提交
4. 系統驗證 Email 是否存在，若存在則寄出密碼重設連結
5. 使用者開啟 Email 並點擊連結，導向重設密碼頁
6. 使用者輸入新密碼並確認送出
7. 系統更新密碼並導向登入頁，提示變更成功

- **結果**：使用者成功重設密碼，可重新登入系統

#### Business Rules for Use Case 2.3

- **BR2.12** _(Security)_：重設連結須設定時效（例如 30 分鐘內有效）
- **BR2.13** _(Validation)_：新密碼需與原密碼不同，且符合安全規則（長度、複雜度）
- **BR2.14** _(Privacy)_：若輸入 Email 不存在，系統仍顯示「已寄送重設信」以避免帳號探測攻擊
- **BR2.15** _(Token Logic)_：每次請求都需產生獨立且不可重複使用的 token
- **BR2.16** _(Logging)_：所有密碼重設行為須記錄於安全日誌中供稽核使用

---

### Customer - User Story 3

作為顧客，我希望能把商品加入購物車或收藏清單，這樣我可以之後再下單。

#### Use Case 3.1 – 加入商品至購物車

- **名稱**：加入購物車
- **起始者**：登入使用者
- **前置條件**：使用者已登入，並正瀏覽商品詳情頁
- **流程**：

1. 使用者開啟某商品詳情頁
2. 點選「加入購物車」按鈕
3. 輸入數量（預設為 1）
4. 系統檢查商品庫存與狀態
5. 若合法，將商品與數量寫入購物車資料表
6. 系統顯示「已成功加入購物車」提示
7. 使用者可選擇「繼續購物」或「前往購物車頁面」

- **結果**：商品與數量成功儲存於該使用者的購物車中，等待後續結帳處理

#### Business Rules for Use Case 3.1

- **BR3.1** _(Access Control)_：未登入使用者無法使用加入購物車或收藏功能，點擊將導向登入頁面
- **BR3.2** _(Product Status)_：若商品為「停售」「下架」「隱藏」，按鈕為 disabled 並顯示提示文字
- **BR3.3** _(Stock Check/Constraint)_：使用者輸入的商品數量不得超過目前庫存，否則系統顯示「庫存不足」並禁止加入。
- **BR3.4** _(Data Persistence)_：每筆購物車紀錄需綁定使用者 ID、商品 ID、數量、單價，並寫入資料庫
- **BR3.5** _(Duplicate Check/Handling)_：若商品已存在購物車，則更新數量，而非新增重複紀錄
- **BR3.6** _(UI Behavior/Feedback)_：加入成功後，系統應顯示 toast 提示訊息，並提供「前往購物車」與「繼續購物」導引按鈕。
- **BR3.7** _(Error Handling)_：若加入購物車時商品查無價格（如為刪除商品），應提示「商品資料異常，請稍後再試」。
- **BR3.8** _(Session Security)_：加入購物車的操作需檢查登入 session 的有效性（防止失效 token）。

#### Use Case 3.2 – 編輯與刪除購物車商品

- **名稱**：管理購物車內容
- **起始者**：已登入使用者
- **前置條件**：使用者已登入並開啟購物車頁面
- **流程**：

1. 使用者開啟購物車頁面
2. 點選某商品的「＋」「−」按鈕調整數量，或點選「刪除」按鈕
3. 系統即時驗證庫存與有效性
4. 更新購物車中的該商品數量或移除
5. 同步更新小計與總金額
6. 若購物車為空，顯示「購物車尚無商品」訊息

- **結果**：使用者可自由調整購物車內容，並即時反映總金額變化

#### Business Rules for Use Case 3.2

- **BR3.7** _(Inventory Constraint)_：調整後商品數量不可超過目前庫存
- **BR3.8** _(Auto-Removal)_：若商品數量調整為 0，則自動從購物車中移除
- **BR3.9** _(Price Sync)_：總金額與各項商品價格應根據目前有效單價即時更新
- **BR3.10** _(Multi-Device Sync)_：若使用者有多個裝置同時操作，需保證伺服器端資料同步與一致性
- **BR3.11** _(UI Integrity)_：若商品已停售，下次開啟購物車時應提示並標示「已下架」商品，並建議移除
- **BR3.12** _(Auto Sync)_：若使用者在多個裝置上同時操作購物車，系統應保證資料同步，避免版本衝突。
- **BR3.13** _(Activity Reminder)_：若購物車中商品即將停售，可在購物車頁面以紅字提醒。

#### Use Case 3.3 – 加入商品至收藏清單

- **名稱**：加入收藏
- **起始者**：已登入使用者
- **前置條件**：使用者已登入，並正在瀏覽商品頁

- **流程**：

1. 使用者瀏覽任一商品詳情頁
2. 點選「加入收藏」按鈕
3. 系統檢查該商品是否已在收藏清單中
4. 若尚未收藏，將商品 ID 寫入使用者收藏清單
5. 顯示「已收藏」提示與對應圖示變化

- **結果**：商品成功加入收藏清單，供用戶日後快速檢視或加入購物車

#### Business Rules for Use Case 3.3

- **BR3.12** _(Access Control)_：未登入使用者點擊收藏按鈕將導向登入頁
- **BR3.13** _(Uniqueness)_：同一商品不可重複加入收藏清單
- **BR3.14** _(Product Validity)_：若商品已停售，仍可收藏但需顯示「停售中」提示
- **BR3.15** _(Data Binding)_：收藏清單資料需綁定使用者 ID 與商品 ID，存入資料庫
- **BR3.16** _(UI Sync)_：已收藏的商品顯示為「❤️ 已收藏」狀態，點擊可取消收藏

---

### Customer - User Story 4

作為顧客，我希望能編輯我的個人資訊，例如收貨地址與聯絡方式，這樣下單時可以快速填寫。

#### Use Case 4.1 – 編輯個人資料（名稱、聯絡方式）

- **名稱**：更新基本個人資訊
- **起始者**：登入使用者
- **前置條件**：使用者已成功登入並進入「會員中心」
- **流程**：

1. 使用者進入「我的帳號」或「個人設定」
2. 系統顯示目前的個人資訊欄位（姓名、Email、電話等）
3. 使用者修改欄位並提交
4. 系統驗證輸入格式（例如：Email 格式、手機號碼格式）
5. 儲存成功後顯示「更新成功」訊息

- **結果**：個人資訊成功更新，並在後續結帳流程中自動套用

#### Business Rules for Use Case 4.1

- **BR4.1** _(Access Control)_：僅限登入狀態下可修改個人資訊
- **BR4.2** _(Validation)_：每個欄位需通過格式驗證（Email 格式、電話長度、姓名不可為空）
- **BR4.3** _(Data Integrity)_：修改後需立即更新資料庫中該使用者的記錄
- **BR4.4** _(Audit Trail)_：系統應記錄修改時間與操作用戶（供日後審核使用）

#### Use Case 4.2 – 管理收貨地址（新增、編輯、刪除）

- **名稱**：新增 / 編輯 / 刪除收貨地址
- **起始者**：登入使用者
- **前置條件**：使用者已成功登入並進入「收貨地址管理」頁面

- **流程**：

1. 使用者點選「新增地址」或在清單中點選某筆地址進行「編輯」或「刪除」
2. 系統顯示表單（新增為空白；編輯則預填原始資料）
3. 使用者輸入或修改資料欄位（姓名、電話、完整地址、郵遞區號）
4. 點選「儲存」後，系統執行資料格式驗證
5. 驗證成功後，儲存進使用者的地址清單
6. 使用者可選擇其中任一筆設為「預設地址」
7. 若點選刪除預設地址，系統提示需先指定新的預設地址

- **結果**：使用者成功新增、更新或刪除多筆收貨地址，並設定預設地址作為結帳流程自動帶入的配送資訊

#### Business Rules for Use Case 4.2

- **BR4.5** _(Access Control)_：僅限登入狀態下可存取地址管理功能
- **BR4.6** _(Address Limit)_：每位使用者最多可儲存 5 筆地址
- **BR4.7** _(Validation)_：地址表單必須包含姓名、電話、完整地址與郵遞區號等必填欄位，並符合格式要求
- **BR4.8** _(Default Address)_：每位使用者僅能指定一筆預設地址，並可於結帳流程自動套用
- **BR4.9** _(Delete Constraint)_：刪除預設地址前，系統必須要求用戶先另行指定其他預設地址

---

### Customer - User Story 5

作為顧客，我希望可以選擇付款方式與配送方式，完成結帳流程，這樣我就能完成訂單。

#### Use Case 5.1 – 結帳並提交訂單

- **名稱**：完成訂單結帳流程
- **起始者**：登入使用者
- **前置條件**：使用者已登入，購物車中有商品
- **流程**：

1. 使用者進入購物車頁面，確認商品明細
2. 點選「前往結帳」
3. 選擇配送方式（宅配、自取）
4. 選擇付款方式（信用卡、PayPal、貨到付款等）
5. 填寫發票資訊（如三聯式、電子發票）與備註（如配送時間要求）
6. 確認訂單內容（商品、地址、金額）
7. 點選「提交訂單」
8. 若為線上付款，跳轉至付款頁面（如綠界、藍新、PayPal）
9. 完成付款後回傳結果，系統建立正式訂單並顯示「訂單成功」頁面

- **結果**：訂單資料成功送出並儲存於系統，付款成功後訂單狀態更新為「已成立」

#### Business Rules for Use Case 5.1

- **BR5.1** _(Cart Check)_：結帳前購物車中不得為空，否則導向提示頁面
- **BR5.2** _(Inventory Lock)_：系統於提交訂單前需再次確認商品庫存並鎖定庫存數量
- **BR5.3** _(Payment Validation)_：線上付款須串接第三方支付流程並正確接收回傳狀態
- **BR5.4** _(Shipping Option)_：不同配送方式對應不同物流處理流程（如宅配 vs. 自取）
- **BR5.5** _(Invoice Requirement)_：發票資訊為必填欄位（預設為電子發票）
- **BR5.6** _(Post-Payment Routing)_：付款成功後自動跳轉至訂單完成頁並提供訂單編號
- **BR5.7** _(Fail Recovery)_：付款失敗或逾時應返回訂單確認頁並提示重新付款

#### Use Case 5.2 – 套用上次使用的配送與付款資訊

- **名稱**：系統預填上次結帳資訊
- **起始者**：登入使用者
- **前置條件**：使用者至少有一筆成功訂單記錄
- **流程**：

1. 使用者點選「前往結帳」進入結帳頁
2. 系統自動帶入使用者上次訂單的付款方式與配送方式
3. 使用者可選擇直接使用或修改選項
4. 繼續後續確認與提交流程

- **結果**：使用者節省再次輸入時間，提高結帳便利性與成功率

#### Business Rules for Use Case 5.2

- **BR5.8** _(Last-Order Binding)_：僅限登入使用者使用，系統依帳號綁定最近一次成功訂單資訊
- **BR5.9** _(Edit Flexibility)_：自動填入的資訊使用者可自由修改後再提交
- **BR5.10** _(Fallback Safety)_：若上次訂單使用的配送或付款方式目前不可用，應提示重新選擇

---

### Customer - User Story 6

作為顧客，我希望能查閱我的訂單記錄與每一筆的配送狀態，這樣我可以確認包裹是否已出貨。

#### Use Case 6.1 – 查詢歷史訂單與配送進度

- **名稱**：查看歷史訂單與出貨狀態
- **起始者**：登入使用者
- **前置條件**：使用者已登入並進入「我的訂單」頁面
- **流程**：

1. 使用者點選「我的帳號」中的「訂單紀錄」
2. 系統列出所有訂單清單（預設為按時間倒序排列）
3. 使用者點選某一筆訂單
4. 系統顯示該訂單的詳情，包括商品資訊、總金額、下單時間與目前配送狀態
5. 若訂單已出貨，顯示配送方式、物流單號與「前往追蹤」連結

- **結果**：使用者能即時查閱各筆訂單的基本資料與出貨狀態，並可前往物流系統追蹤配送進度

#### Business Rules for Use Case 6.1

- **BR6.1** _(Access Control)_：僅登入後才能存取訂單紀錄；每筆訂單必須綁定該帳號
- **BR6.2** _(Data Consistency)_：訂單清單與狀態應即時同步資料庫，顯示最新進度
- **BR6.3** _(Tracking Info)_：已出貨訂單須顯示物流單號與對應超連結，未出貨則顯示「處理中」或預計出貨時間
- **BR6.4** _(Privacy Binding)_：不得查閱非本人訂單；後端查詢必須以帳號作為查詢條件

#### Use Case 6.2 – 查看訂單的電子發票與物流資訊

- **名稱**：顯示訂單發票與追蹤資訊
- **起始者**：登入使用者
- **前置條件**：使用者已登入並點選特定訂單進入詳情頁
- **流程**：

1. 使用者進入某筆訂單詳情頁
2. 系統顯示該筆訂單的電子發票連結（如 PDF 或發票載具資訊）
3. 若該訂單已出貨，顯示物流公司名稱、追蹤碼與「前往追蹤」按鈕
4. 使用者點擊後可跳轉至對應物流業者之追蹤頁面

- **結果**：使用者可下載或查閱發票資訊，並追蹤配送進度

#### Business Rules for Use Case 6.2

- **BR6.5** _(Invoice Availability)_：訂單成立後 24 小時內應提供發票下載連結；發票格式須為政府規範格式（如 PDF、載具碼）
- **BR6.6** _(Tracking Integrity)_：追蹤連結需正確串接至物流 API 或官方查詢頁，並顯示即時資訊
- **BR6.7** _(Access Scope)_：每筆電子發票僅限原訂購帳號可查閱，避免外部連結洩露
- **BR6.8** _(Fallback Handling)_：若物流或發票資訊尚未生成，應顯示「尚未建立」或「請稍後再試」提示訊息

---

### Customer – User Story 7

作為顧客，我希望能收到 Email 或簡訊通知，提醒我訂單成功、已出貨或取消，這樣我不需要自己反覆查詢。

#### Use Case 7.1 – 接收訂單進度通知

- **名稱**：系統發送訂單狀態通知（Email / 簡訊）
- **起始者**：系統（自動觸發）
- **前置條件**：顧客已完成訂單，並於帳號中填寫有效聯絡資訊
- **流程**：

1. 使用者完成訂單後，系統自動發送「訂單成功」Email（或簡訊）
2. 當訂單狀態變更（如「已出貨」、「已取消」、「配送中」等）
3. 系統根據使用者通知偏好，發送對應 Email 或簡訊
4. 通知內文包含訂單摘要、出貨資訊與「查看訂單」按鈕
5. 系統記錄通知發送紀錄與結果（成功 / 失敗）

- **結果**：顧客會在訂單每次狀態異動時，收到即時提醒通知

#### Business Rules for Use Case 7.1

- **BR7.1** _(Trigger Timing)_：所有通知必須於事件發生後 1 分鐘內自動發送
- **BR7.2** _(Delivery Channel)_：若用戶同時勾選 Email 與簡訊，則系統需雙重發送；否則僅依據偏好處理
- **BR7.3** _(Content Structure)_：通知內容需包含訂單編號、狀態描述、簡要商品摘要與連結
- **BR7.4** _(Contact Validation)_：僅對有效的 Email 與手機號碼發送通知，失敗次數超過 3 次則停發
- **BR7.5** _(Log Record)_：每封通知需記錄發送時間、類型與是否成功，作為後台客服查詢依據

#### Use Case 7.2 – 設定通知偏好

- **名稱**：用戶自訂通知接收方式
- **起始者**：登入使用者
- **前置條件**：使用者已登入並進入帳號設定頁面
- **流程**：

1. 使用者進入「帳號設定」>「通知偏好」
2. 勾選「僅 Email」、「僅簡訊」或「Email + 簡訊」
3. 系統即時儲存偏好設定，並更新至使用者資料中
4. 後續所有訂單通知將依該設定發送

- **結果**：使用者可掌控通知管道，避免干擾或遺漏重要訊息

#### Business Rules for Use Case 7.2

- **BR7.6** _(Preference Persistence)_：每次更改通知偏好，須即時同步儲存至後端資料庫
- **BR7.7** _(Channel Verification)_：啟用簡訊通知前需完成手機號碼驗證；Email 同理
- **BR7.8** _(Default Setting)_：新註冊帳號預設為「Email 通知」，使用者可隨時修改
- **BR7.9** _(Preference Scope)_：通知偏好設定適用於所有與訂單相關的系統通知

---

### Customer – User Story 8

作為顧客，我希望可以留言或給商品評價，這樣其他買家也能參考我的經驗。

#### Use Case 8.1 – 商品留言與評價

- **名稱**：提交商品評價與留言
- **起始者**：Customer（已登入且曾購買該商品）
- **前置條件**：
  - 使用者已登入帳號
  - 該商品已有成功訂單記錄（已完成付款）

- **流程**：

1. 使用者進入某商品的詳情頁
2. 點選「我要評價」按鈕
3. 輸入評論文字（最多 500 字）與星級（1～5 星）
4. 系統驗證使用者是否為該商品的實際購買者
5. 若驗證通過，系統儲存評價並即時顯示於商品下方
6. 系統更新商品平均評分與評價總數

- **結果**：顧客成功發表評價，並在商品頁即時顯示，其他用戶可見

#### Business Rules for Use Case 8.1

- **BR8.1** _(Verified Purchase Only)_：只有實際購買過該商品的使用者才能提交評價
- **BR8.2** _(One Review Per Order)_：每位使用者每筆訂單僅能對該商品評價一次
- **BR8.3** _(Text Limit)_：留言內容不得超過 500 字，且禁止含有違規或辱罵詞彙（系統需做基本過濾）
- **BR8.4** _(Rating Range)_：星等必須為 1 至 5 星之間的整數
- **BR8.5** _(Display Timing)_：通過驗證後的留言需立即顯示於前端，無需等待審核
- **BR8.6** _(Anonymity Option)_：使用者可選擇是否匿名顯示名稱（預設為顯示）

#### Use Case 8.2 – 修改或刪除商品評價

- **名稱**：修改 / 刪除商品留言
- **起始者**：Customer（已登入並曾留言）
- **前置條件**：
  - 使用者已登入帳號
  - 該筆評價為使用者本人所撰寫

- **流程**：

1. 使用者進入商品詳情頁，切換至「我的評價」
2. 點選「編輯」或「刪除」按鈕
3. 若選擇編輯，顯示原始內容供修改
4. 點選儲存後，系統更新內容於前端即時反映
5. 若選擇刪除，系統顯示確認提示，點選後移除該筆留言

- **結果**：使用者可隨時修改或移除自己的留言內容，系統即時更新前端畫面

#### Business Rules for Use Case 8.2

- **BR8.7** _(Edit Limit)_：每則評價每日僅能編輯 3 次，避免濫用
- **BR8.8** _(Ownership Check)_：使用者僅能編輯或刪除自己的留言
- **BR8.9** _(Audit Trail)_：系統需保留所有原始與變更紀錄供管理員查詢（非顯示給前台）
- **BR8.10** _(UI Behavior)_：刪除留言後應即時從頁面移除，不需重新整理



---

**User Story 9：**
作為顧客，我希望可以查閱我的積分、優惠券或會員等級，這樣我能清楚知道有什麼優惠。

> **Use Case 9：** 查看會員權益資訊
角色身份：Customer（已登入）
流程：
一，使用者登入後進入「會員中心」或「我的優惠」
二，系統顯示該使用者當前的會員等級、累積積分、有效優惠券清單
三，可點選查看各項權益說明（例：VIP 一級可享 5% 折扣）
四，若積分接近升級門檻，系統自動提示
結果：顧客清楚掌握自己現有優惠與會員狀態

> ⑨ 優惠與會員資訊：
> **Use Case 2：** 系統提示尚未使用的優惠券
起始者：已登入顧客
流程：
一， 結帳過程中
二， 系統顯示「您有尚未使用的優惠券：`$50` 折扣」
三， 使用者點選套用，系統即時更新金額

---

**User Story 10：**
作為顧客，我希望能夠停用帳號或申請刪除帳號資料，這樣我可以主動控制我的個資與帳號狀態。

> **Use Case 10：** 帳號停用或刪除申請
角色身份：Customer（已登入）
流程：
一，使用者進入「帳號設定」頁面
二，點選「停用帳號」或「刪除帳號」選項
三，系統顯示提醒與確認視窗
四，使用者輸入密碼確認身份
五，若選擇停用，系統將帳號設為不可登入狀態
六，若選擇刪除，系統記錄申請，等待審核或延遲執行
七，執行後，使用者將無法登入，相關資料依法律規定處理
結果：顧客完成停用或刪除申請，系統即時限制帳號操作

> ⑩ 停用或刪除帳號：
> **Use Case 2：** 帳號刪除流程需經二次驗證（Email或手機驗證碼）
起始者：已登入顧客
流程：
一， 點選「我要刪除帳號」
二， 系統寄出一次性驗證碼
三， 使用者輸入驗證碼後系統才允許刪除

---

**User Story 11：**
作為顧客，我希望能查看附近的實體門市資訊，並選擇是否要到店自取，這樣我可以節省運費或立即取得商品。

> **Use Case 11：** 選擇取貨門市
起始者：Customer（已登入）
流程：
一， 使用者在結帳頁選擇「配送方式」
二， 系統顯示「宅配」與「門市自取」選項
三， 若選擇「門市自取」，系統根據使用者地理位置列出可用門市（含地址、營業時間）
四， 使用者選擇其中一間門市，系統儲存該資訊於訂單資料中
結果：系統將該訂單標註為自取，指定自取門市位置

> ⑪ 查看實體門市：
> **Use Case 2：** 使用地圖篩選離我最近的門市並查詢自取時段
起始者：已登入顧客
流程：
一， 開啟地圖
二， 系統以定位篩選附近門市
三， 顧客點選一間門市查看「可自取時間」

---

**User Story 12：**
作為顧客，我希望能在促銷期間使用折扣碼或優惠券，並在結帳時計算優惠，這樣我可以感覺物超所值。

> **Use Case 12：** 使用折扣碼結帳
起始者：Customer（已登入）
流程：
一， 使用者進入結帳頁面
二， 系統提供「輸入優惠碼」輸入欄位
三， 使用者輸入折扣碼並點選「套用」
四， 系統驗證折扣碼是否有效，並即時更新訂單總金額
五， 若成功，顯示優惠明細；若失敗，顯示錯誤提示
結果：訂單應付金額更新，優惠碼資料與訂單綁定

> ⑫ 使用折扣碼與優惠券：
> **Use Case 2：** 折扣碼錯誤時提示錯誤原因
起始者：已登入顧客
流程：
一， 顧客輸入錯誤折扣碼
二， 系統提示「已過期」、「限會員」或「最低消費未達」等資訊

---

**User Story 13：**
作為顧客，我希望可以收到針對我的購買行為的推薦商品，這樣我可以快速發現我可能需要的新商品。

> **Use Case 13：** 顯示推薦商品
起始者：Customer（登入或未登入皆可）
流程：
一， 使用者進入首頁或商品列表頁
二， 系統讀取其最近購物紀錄或瀏覽紀錄（若未登入則使用 cookie）
三， 系統依據邏輯推薦相關商品（熱門品項、同分類、常購搭配）
四， 推薦商品區塊在頁面上方或側邊顯示
結果：使用者看到個人化商品推薦清單，可點入查看更多

> ⑬ 商品推薦機制：
> **Use Case 2：** 顧客可隱藏不感興趣的推薦商品
起始者：已登入顧客
流程：
一， 在首頁推薦區點選「不感興趣」
二， 系統立即移除並學習推薦模型參數

---

**User Story 14：**
作為顧客，我希望可以設定商品補貨提醒或追蹤缺貨商品，這樣一旦商品補貨我能第一時間知道。

> **Use Case 14：** 追蹤缺貨商品
起始者：Customer（已登入）
流程：
一， 使用者進入商品頁，該商品顯示為「缺貨中」
二， 顯示「通知我」按鈕
三， 點選後，系統將使用者與該商品建立一筆「補貨通知追蹤」資料
四， 當商品庫存更新為可售狀態，系統自動發送通知（email 或 app 推播）
結果：使用者在商品補貨時收到提醒，可立即回到網站下單

> ⑭ 補貨通知與追蹤：
> **Use Case 2：** 顧客取消追蹤某商品
起始者：已登入顧客
流程：
一， 在「追蹤商品列表」中點選某商品
二， 點擊「取消追蹤」
三， 系統移除通知設定

---

**User Story 15：**
作為顧客，我希望能夠在訂單還沒出貨前，進行取消或修改訂單，這樣我能避免下錯單或資訊有誤。

> **Use Case 15：** 取消未出貨訂單
起始者：Customer（已登入）
流程：
一， 使用者進入「我的訂單」頁面
二， 系統列出所有訂單及其狀態
三， 尚未進入「已出貨」狀態的訂單顯示「取消」或「修改」按鈕
四， 點擊後進入取消流程（選擇原因 → 確認送出）或編輯頁面（地址、付款方式等）
五， 系統更新訂單狀態為「已取消」或重新儲存資料
結果：訂單被取消或更新，觸發對應的退款／資料更新流程

> ⑮ 修改與取消未出貨訂單：
> **Use Case 2：** 客服審核訂單修改後通知顧客結果
起始者：已登入顧客 + 系統通知機制
流程：
一， 顧客提出取消/修改請求
二， 系統進入審核流程（或由人工處理）
三， 顧客收到 Email 通知「修改已批准」或「未通過，原因：已打包」

---

### 字段需求分析矩陣

**基於 7 個主用戶角色的字段需求**：

| 字段分類 | 字段名 | Customer | Store Associate | Delivery Driver | Supplier | Support | Admin | Staff |
|----------|--------|----------|----------------|----------------|----------|---------|-------|-------|
| **基礎必需** | username | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **基礎必需** | email | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **基礎必需** | phone | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **基礎必需** | user_type | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **基礎必需** | sub_role | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **會員系統** | member_level | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **會員系統** | member_points | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **會員系統** | wholesale_discount | ✅(批發) | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **店員專用** | store_position | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **店員專用** | can_process_orders | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **店員專用** | can_manage_inventory | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **配送專用** | vehicle_type | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **配送專用** | delivery_area | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **商業信息** | company_name | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ |
| **商業信息** | business_license | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ |
| **員工信息** | employee_id | ❌ | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ |
| **員工信息** | hire_date | ❌ | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ |

### 關鍵業務邏輯設計

#### 1. **會員積分/批發折扣系統**

```python
# Customer 專用字段
member_level = models.IntegerField(null=True, blank=True)          # 會員等級
member_points = models.IntegerField(default=0)                     # 會員積分
wholesale_discount = models.DecimalField(max_digits=5, decimal_places=2, null=True, blank=True)  # 批發折扣率
```

#### 2. **到店取貨業務流程**

- Customer 下單選擇「到店取貨」
- Store Associate 收到取貨通知
- Store Associate 準備商品並通知客戶
- Customer 到店出示訂單號取貨

#### 3. **Local 配送業務流程**

- Customer 下單選擇「配送」
- Delivery Driver 接收配送任務
- Delivery Driver 更新配送狀態
- Customer 收到配送通知

### 待確認問題

**請確認以下設計是否符合您的業務需求**：

1. **主用戶角色**：7個主角色是否完整？
2. **Customer 子角色**：會員等級+批發客戶分類是否合理？
3. **Store Associate 子角色**：4個子角色是否涵蓋實際工作？
4. **字段設計**：是否有遺漏的重要字段？
5. **業務流程**：取貨和配送流程是否正確？

**⚠️ 請逐項確認，確認後我們開始設計具體的 models.py 結構！**
